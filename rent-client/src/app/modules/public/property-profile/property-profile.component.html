<div class="profile-container" *ngIf="!loading && apartment">
  <div class="media-section" *ngIf="apartment.images?.length">
    <div class="main-image-wrapper">
      <img [src]="apartment.images[0]" class="hero-image">
      <div class="price-overlay">{{apartment.price | number}} â‚ª</div>
    </div>
    <div class="image-gallery" *ngIf="apartment.images.length > 1">
      <img *ngFor="let img of apartment.images.slice(1)" [src]="img" class="gallery-thumb">
    </div>
  </div>

  <div class="content-section">
    <div class="property-header">
      <h1>{{apartment.city}}</h1>
      <p class="address">{{apartment.address}}</p>
      
      <div class="stats-row">
        <div class="stat">
          <span class="value">{{apartment.rooms}}</span>
          <span class="label">×—×“×¨×™×</span>
        </div>
        <div class="stat">
          <span class="value">{{apartment.floor}}</span>
          <span class="label">×§×•××”</span>
        </div>
        <div class="stat">
          <span class="value">{{apartment.sqm}}</span>
          <span class="label">×"×¨</span>
        </div>
      </div>
    </div>

    <mat-card class="description-card">
      <mat-card-content>
        <h3>×ª×™××•×¨ ×”× ×›×¡</h3>
        <p>{{apartment.description}}</p>
      </mat-card-content>
    </mat-card>

    <div class="features-section">
      <h3>××” ×™×© ×‘×“×™×¨×”?</h3>
      <div class="features-grid">
        <div class="feature" [class.inactive]="!apartment.balcony">
          <mat-icon>balcony</mat-icon> <span>××¨×¤×¡×ª</span>
        </div>
        <div class="feature" [class.inactive]="!apartment.parking">
          <mat-icon>local_parking</mat-icon> <span>×—× ×™×”</span>
        </div>
        <div class="feature" [class.inactive]="!apartment.elevator">
          <mat-icon>elevator</mat-icon> <span>××¢×œ×™×ª</span>
        </div>
        <div class="feature" [class.inactive]="!apartment.mamad">
          <mat-icon>security</mat-icon> <span>××"×“</span>
        </div>
        <div class="feature" [class.inactive]="!apartment.furnished">
          <mat-icon>chair</mat-icon> <span>××¨×•×”×˜×ª</span>
        </div>
        <div class="feature" [class.inactive]="!apartment.petsAllowed">
          <mat-icon>pets</mat-icon> <span>×—×™×•×ª ××—××“</span>
        </div>
      </div>
    </div>

    <mat-card class="financial-card">
      <mat-card-content>
        <div class="financial-row">
          <div class="item">
            <span class="label">×›× ×™×¡×”</span>
            <span class="value">{{apartment.entryDate ? (apartment.entryDate | date:'dd/MM/yy') : '××™×™×“×™'}}</span>
          </div>
          <div class="item">
            <span class="label">××¨× ×•× ×”</span>
            <span class="value">{{apartment.arnona || 0}} â‚ª</span>
          </div>
          <div class="item">
            <span class="label">×•×¢×“ ×‘×™×ª</span>
            <span class="value">{{apartment.vaadBayit || 0}} â‚ª</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Neighborhood & Map Section -->
    <div class="neighborhood-section" *ngIf="apartment.lat && apartment.lng">
      <h3>××” ×‘×¡×‘×™×‘×”? ğŸ“</h3>
      <div id="map" class="property-map"></div>

      <div class="neighborhood-data" *ngIf="apartment.neighborhoodData">
        <!-- Bus Stops -->
        <div class="info-group" *ngIf="apartment.neighborhoodData.busStops?.length">
          <div class="group-header">
            <mat-icon>directions_bus</mat-icon>
            <span>×ª×—×‘×•×¨×” ×¦×™×‘×•×¨×™×ª</span>
          </div>
          <div class="info-list">
            <div class="info-item" *ngFor="let stop of apartment.neighborhoodData.busStops">
              <span class="item-name">{{stop.name}}</span>
              <span class="item-meta">×§×•×•×™×: {{stop.lines}} â€¢ <b>{{stop.distance}} ×§"×</b></span>
            </div>
          </div>
        </div>

        <!-- Schools -->
        <div class="info-group" *ngIf="apartment.neighborhoodData.schools?.length">
          <div class="group-header">
            <mat-icon>school</mat-icon>
            <span>××•×¡×“×•×ª ×—×™× ×•×š</span>
          </div>
          <div class="info-list">
            <div class="info-item" *ngFor="let school of apartment.neighborhoodData.schools">
              <span class="item-name">{{school.name}}</span>
              <span class="item-meta">{{school.type}} â€¢ {{school.address}} â€¢ <b>{{school.distance}} ×§"×</b></span>
            </div>
          </div>
        </div>

        <!-- Urban Renewal -->
        <div class="info-group" *ngIf="apartment.neighborhoodData.urbanRenewal?.isInProject">
          <div class="group-header alert">
            <mat-icon>engineering</mat-icon>
            <span>×”×ª×—×“×©×•×ª ×¢×™×¨×•× ×™×ª</span>
          </div>
          <div class="info-list">
            <div class="info-item project">
              <span class="item-name">{{apartment.neighborhoodData.urbanRenewal.projectName}}</span>
              <span class="item-meta">×¡×˜×˜×•×¡: {{apartment.neighborhoodData.urbanRenewal.status}} ({{apartment.neighborhoodData.urbanRenewal.type}})</span>
            </div>
          </div>
        </div>

        <!-- Health Clinics -->
        <div class="info-group" *ngIf="apartment.neighborhoodData.healthClinics?.length">
          <div class="group-header">
            <mat-icon>local_hospital</mat-icon>
            <span>××¨×¤××•×ª ×•×§×•×¤×•×ª ×—×•×œ×™×</span>
          </div>
          <div class="info-list">
            <div class="info-item" *ngFor="let clinic of apartment.neighborhoodData.healthClinics">
              <span class="item-name">{{clinic.name}}</span>
              <span class="item-meta">{{clinic.type}} â€¢ {{clinic.address}} â€¢ <b>{{clinic.distance}} ×§"×</b></span>
            </div>
          </div>
        </div>

        <!-- Recent Sales -->
        <div class="info-group" *ngIf="apartment.neighborhoodData.recentSales?.length">
          <div class="group-header">
            <mat-icon>analytics</mat-icon>
            <span>×¢×¡×§××•×ª × ×“×œ"×Ÿ ××—×¨×•× ×•×ª ×‘××–×•×¨</span>
          </div>
          <div class="info-list">
            <div class="info-item sale" *ngFor="let sale of apartment.neighborhoodData.recentSales">
              <span class="item-name">{{sale.price}}</span>
              <span class="item-meta">{{sale.address}} â€¢ {{sale.date}}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sticky Actions for Mobile -->
  <div class="sticky-actions">
    <button mat-raised-button color="primary" (click)="openWaze()" class="action-btn">
      <mat-icon>directions_car</mat-icon> × ×™×•×•×˜ ×‘-Waze
    </button>
    <a mat-raised-button color="accent" [href]="'https://t.me/dvir_rent_bot?start=' + apartment.id.split('-')[0]" class="action-btn">
      <mat-icon>chat</mat-icon> ×ª×™××•× ×¡×™×•×¨ ×‘×‘×•×˜
    </a>
  </div>
</div>

<div class="loading-state" *ngIf="loading">
  <mat-spinner diameter="50"></mat-spinner>
  <p>×˜×•×¢×Ÿ ×¤×¨×˜×™ × ×›×¡...</p>
</div>

<div class="error-state" *ngIf="error">
  <mat-icon color="warn">error_outline</mat-icon>
  <h2>×”× ×›×¡ ×œ× × ××¦× ××• ×©×”×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ</h2>
  <button mat-raised-button color="primary" routerLink="/">×—×–×¨×” ×œ×“×£ ×”×‘×™×ª</button>
</div>
